_format_version: "3.0"

# Global plugins
plugins:
- name: cors
  config:
    origins: ["*"]
    methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
    headers: ["Authorization", "Content-Type", "X-Requested-With"]
    credentials: true
    max_age: 3600
    preflight_continue: false

- name: prometheus
  config:
    per_consumer: true
    status_code_metrics: true
    latency_metrics: true
    bandwidth_metrics: true
    upstream_health_metrics: true

# Services and Routes
services:
# STERENOVA-FLUX-BACKEND
- name: sterenova-flux-backend
  url: http://sterenova-flux-backend:3002
  routes:
  - name: flux-backend-route
    paths: ["/api/flux"]
    strip_path: true
    methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
  plugins:
  - name: rate-limiting
    config:
      minute: 100
      hour: 1000
      policy: local
  - name: request-size-limiting
    config:
      allowed_payload_size: 10

# STERENOVA-STUDIO-BACKEND
- name: sterenova-studio-backend
  url: http://sterenova-studio-backend:3000
  routes:
  - name: studio-backend-route
    paths: ["/api/studio"]
    strip_path: true
    methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
  plugins:
  - name: rate-limiting
    config:
      minute: 100
      hour: 1000
      policy: local
  - name: request-size-limiting
    config:
      allowed_payload_size: 10

# STERENOVA-FLUX-FRONTEND
- name: sterenova-flux-frontend
  url: http://sterenova-flux-frontend:3000
  routes:
  - name: flux-frontend-route
    paths: ["/flux"]
    strip_path: true
    methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
  - name: flux-assets-route
    paths: ["/flux/_next", "/flux/logo.svg", "/flux/favicon.ico"]
    strip_path: true
    methods: ["GET", "OPTIONS"]
  plugins:
  - name: cors
    config:
      origins: ["*"]
      methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
      headers: ["Authorization", "Content-Type", "X-Requested-With"]
      credentials: true
      max_age: 3600
      preflight_continue: false

# STERENOVA-STUDIO-FRONTEND
- name: sterenova-studio-frontend
  url: http://sterenova-studio-frontend:3000
  routes:
  - name: studio-frontend-route
    paths: ["/studio"]
    strip_path: true
    methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
  - name: studio-assets-route
    paths: ["/studio/_next", "/studio/logo.svg", "/studio/favicon.ico"]
    strip_path: true
    methods: ["GET", "OPTIONS"]
  plugins:
  - name: cors
    config:
      origins: ["*"]
      methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
      headers: ["Authorization", "Content-Type", "X-Requested-With"]
      credentials: true
      max_age: 3600
      preflight_continue: false

# Health check endpoint (no auth required)
- name: kong-health
  url: http://kong:8001
  routes:
  - name: kong-health-route
    paths: ["/health"]
    strip_path: true
    methods: ["GET"]

# Keycloak service (for token validation)
- name: keycloak-service
  url: http://keycloak:8080
  routes:
  - name: keycloak-routes
    paths: ["/realms/platform"]
    strip_path: false
    methods: ["GET", "POST"]





# demo frontend
- name: demo-web
  url: http://demo-web:80
  routes:
  - name: demo-web-route
    paths: ["/demo"]
    strip_path: true
    methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
  plugins:
  - name: cors
    config:
      origins: ["*"]
      methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
      headers: ["Authorization", "Content-Type", "X-Requested-With"]
      credentials: true
      max_age: 3600
      preflight_continue: false
